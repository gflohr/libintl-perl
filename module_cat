#! /usr/bin/perl -w

use strict;

my (@include) = @ARGV;
die "$0 MODULE[, MODULE ...]" unless @include;

my $s = "[ \t\r]";

print <<EOF;
#! /bin/false

###########################################################################
# This file is generated, do not edit! Edit the input files instead!
# See the Makefile from the source distribution of libintl-perl for
# details.
############################################################################

EOF

my $count = 0;
FILE: foreach my $file (@include) {
    my $not_last = ++$count != @include;
    local *HANDLE;
    open HANDLE, "<$file" or die "Cannot open '$file': $!.\n";

    my $code_seen;
    
    foreach my $line (<HANDLE>) {
        if (!$code_seen) {
                next if $line =~ /^$s*(?:#.*)?$/;
                $code_seen = 1;
        }
        next if $not_last && $line =~ /^$s*[0-9]+$s*;$s*$/;
        last if $not_last && $line =~ /^__END__$/;
	$line =~ s/use$s+Locale::TextDomain$s+qw$s*\(imperia\)$s*;
	          /use Locale::TextDomain 'libintl-perl';/x;
	print $line;
    }
}
